# GoVM 开发文档

## 项目简介

GoVM 是一个用 Go 语言编写的 Go 版本管理工具，提供图形化界面（GUI），支持 Windows/Linux/macOS 平台。用户只需鼠标点击即可完成 Go 环境的安装、切换和管理。

## 技术栈

### 核心框架

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| 后端 | Go 1.21+ | 处理版本下载、环境切换等核心逻辑 |
| GUI 框架 | Wails v2 | Go + Web 技术的桌面应用框架 |
| 前端框架 | Vue 3 + TypeScript | 现代化前端开发 |
| UI 组件库 | Element Plus | 美观的 Vue 3 组件库 |
| 状态管理 | Pinia | Vue 3 官方状态管理 |
| 构建工具 | Vite | 快速的前端构建工具 |

### 后端依赖

```go
github.com/wailsapp/wails/v2       // GUI 框架
golang.org/x/sys/windows/registry  // Windows 注册表操作
```

### 前端依赖

```json
{
  "vue": "^3.4.x",
  "element-plus": "^2.5.x",
  "pinia": "^2.1.x",
  "@element-plus/icons-vue": "^2.3.x"
}
```

## 目录结构

```
govm/
├── main.go                 # 程序入口
├── app.go                  # Wails 应用绑定
├── wails.json              # Wails 配置
├── build/                  # 构建输出
│   └── windows/            # Windows 资源文件
├── internal/               # 后端核心逻辑
│   ├── version/            # 版本管理（下载、安装、切换）
│   ├── config/             # 配置管理
│   ├── env/                # 环境变量操作
│   ├── tool/               # Go 工具链管理
│   ├── cache/              # 缓存管理
│   └── doctor/             # 环境诊断
├── frontend/               # 前端代码
│   ├── src/
│   │   ├── App.vue
│   │   ├── main.ts
│   │   ├── views/          # 页面
│   │   │   ├── VersionManager.vue
│   │   │   ├── EnvConfig.vue
│   │   │   ├── ToolChain.vue
│   │   │   ├── CacheManager.vue
│   │   │   └── Settings.vue
│   │   ├── components/     # 组件
│   │   ├── stores/         # Pinia 状态
│   │   └── api/            # 调用后端方法
│   ├── index.html
│   ├── package.json
│   ├── vite.config.ts
│   └── tsconfig.json
├── docs/                   # 文档
└── go.mod
```

## 存储路径

| 项目 | Windows | Linux/macOS |
|------|---------|-------------|
| 版本存储 | `%USERPROFILE%\.govm\versions\` | `~/.govm/versions/` |
| 配置文件 | `%USERPROFILE%\.govm\config.json` | `~/.govm/config.json` |
| 下载缓存 | `%USERPROFILE%\.govm\cache\` | `~/.govm/cache/` |
| 当前版本 | `%USERPROFILE%\.govm\current` | `~/.govm/current` |

## 配置文件结构

```json
{
  "mirror": "https://go.dev/dl/",
  "proxy": "",
  "goproxy": "https://proxy.golang.org,direct",
  "default_version": "1.21.5",
  "aliases": {
    "stable": "1.21.5",
    "dev": "1.22rc1"
  },
  "theme": "light",
  "language": "zh-CN"
}
```

---

## 界面设计

### 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  GoVM - Go 版本管理器                              _ □ ×    │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────┐  ┌────────────────────────────────────────┐ │
│  │            │  │                                        │ │
│  │  📦 版本管理 │  │  内容区域                              │ │
│  │            │  │                                        │ │
│  │  ⚙️ 环境配置 │  │                                        │ │
│  │            │  │                                        │ │
│  │  🔧 工具链  │  │                                        │ │
│  │            │  │                                        │ │
│  │  🗑️ 缓存清理 │  │                                        │ │
│  │            │  │                                        │ │
│  │  ⚡ 设置    │  │                                        │ │
│  │            │  │                                        │ │
│  └────────────┘  └────────────────────────────────────────┘ │
│                                                             │
│  状态栏: 当前版本 Go 1.21.5 | 镜像源: 阿里云                  │
└─────────────────────────────────────────────────────────────┘
```

### 页面功能

#### 1. 版本管理页

- 已安装版本列表（带切换、卸载按钮）
- 可用版本列表（带安装按钮、筛选稳定版/RC/Beta）
- 下载进度条
- 一键升级到最新版

#### 2. 环境配置页

- 当前环境变量显示（GOROOT/GOPATH/GOPROXY）
- 环境诊断（一键检测问题）
- 项目级版本配置（.go-version）

#### 3. 工具链页

- 常用工具列表（gopls/dlv/golangci-lint 等）
- 一键安装/卸载/升级

#### 4. 缓存清理页

- 缓存大小统计
- 下载缓存清理
- 模块缓存清理

#### 5. 设置页

- 镜像源选择（官方/阿里云/中科大等）
- HTTP 代理配置
- GOPROXY 配置
- 主题切换（亮色/暗色）
- 语言切换

---

## 功能清单

### 一、版本管理（10 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 1 | 获取远程版本列表 | 自动加载 + 刷新按钮 | P0 |
| 2 | 筛选稳定版 | 下拉筛选框 | P0 |
| 3 | 显示已安装版本 | 列表展示，当前版本高亮 | P0 |
| 4 | 安装指定版本 | 点击「安装」按钮 | P0 |
| 5 | 安装最新稳定版 | 点击「安装最新版」按钮 | P1 |
| 6 | 安装最新 RC 版本 | 筛选 RC 后点击安装 | P2 |
| 7 | 卸载版本 | 点击「卸载」按钮 | P0 |
| 8 | 清理旧版本 | 点击「清理旧版本」，选择保留数量 | P2 |
| 9 | 升级到最新版 | 点击「升级」按钮 | P1 |
| 10 | 离线安装 | 点击「导入本地包」，选择 zip 文件 | P2 |

### 二、版本切换（6 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 11 | 全局切换版本 | 点击版本旁的「使用」按钮 | P0 |
| 12 | 仅当前会话生效 | 勾选「仅本次会话」 | P2 |
| 13 | 项目级版本设置 | 在项目配置页设置 | P1 |
| 14 | 显示当前版本 | 状态栏常驻显示 | P0 |
| 15 | 自动切换版本 | 设置中开启「自动检测项目版本」 | P1 |
| 16 | 设置默认版本 | 右键菜单「设为默认」 | P1 |

### 三、环境信息（4 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 17 | 显示环境变量 | 环境配置页展示 | P1 |
| 18 | 复制环境变量值 | 点击复制图标 | P1 |
| 19 | 环境诊断 | 点击「诊断」按钮，显示问题列表 | P1 |
| 20 | 显示 Go 路径 | 环境配置页展示 | P1 |

### 四、配置管理（6 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 21 | 显示配置 | 设置页展示所有配置项 | P1 |
| 22 | 设置镜像源 | 下拉选择或输入自定义 | P0 |
| 23 | 设置 HTTP 代理 | 输入框填写 | P1 |
| 24 | 设置 GOPROXY | 输入框填写 | P1 |
| 25 | 重置配置 | 点击「恢复默认」按钮 | P2 |
| 26 | 导出/导入配置 | 点击「导出」/「导入」按钮 | P2 |

### 五、工具链管理（4 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 27 | 安装 Go 工具 | 工具列表点击「安装」 | P2 |
| 28 | 显示已安装工具 | 列表展示，已安装标记 | P2 |
| 29 | 升级工具 | 点击「全部升级」或单个升级 | P2 |
| 30 | 卸载工具 | 点击「卸载」按钮 | P2 |

### 六、缓存与清理（3 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 31 | 清理下载缓存 | 点击「清理下载缓存」 | P1 |
| 32 | 清理所有缓存 | 点击「清理全部」 | P2 |
| 33 | 显示缓存大小 | 缓存页展示统计信息 | P2 |

### 七、包管理（10 个）- 新增

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 34 | GOPATH 模式切换 | 设置页选择「共享」或「隔离」模式 | P1 |
| 35 | 查看模块缓存 | 包管理页展示已下载模块列表 | P1 |
| 36 | 清理模块缓存 | 点击「清理模块缓存」按钮 | P1 |
| 37 | 清理指定模块 | 选择模块后点击「删除」 | P2 |
| 38 | 模块安全校验 | 点击「校验」验证模块 checksum | P2 |
| 39 | 查看模块详情 | 点击模块查看版本、大小、依赖 | P2 |
| 40 | 搜索模块 | 输入模块名搜索 | P2 |
| 41 | GOPATH 路径配置 | 设置自定义 GOPATH 路径 | P1 |
| 42 | 模块缓存统计 | 显示模块数量、总大小 | P1 |
| 43 | 一键修复模块 | 运行 go mod tidy/verify | P2 |

### 八、自身管理（4 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 44 | 检查更新 | 设置页点击「检查更新」 | P2 |
| 45 | 显示版本信息 | 关于对话框 | P0 |
| 46 | 初始化环境 | 首次启动自动引导 | P0 |
| 47 | 完全卸载 | 设置页点击「卸载 GoVM」 | P2 |

### 九、高级功能（8 个）

| # | 功能 | GUI 操作 | 优先级 |
|---|------|----------|--------|
| 48 | 创建版本别名 | 右键菜单「创建别名」 | P2 |
| 49 | 删除别名 | 别名列表点击删除 | P2 |
| 50 | 显示别名列表 | 版本管理页展示 | P2 |
| 51 | 用指定版本运行命令 | 右键菜单「用此版本运行...」 | P2 |
| 52 | 用项目版本执行命令 | 工具栏快捷入口 | P2 |
| 53 | 打开终端 | 点击「打开终端」使用当前版本 | P2 |
| 54 | 主题切换 | 设置页切换亮色/暗色 | P1 |
| 55 | 语言切换 | 设置页切换中文/英文 | P1 |

---

## 包管理设计

### GOPATH 模式

#### 共享模式（推荐）
- 所有 Go 版本共用一个 GOPATH
- 模块缓存位置：`GOPATH/pkg/mod`
- 优点：节省磁盘空间，模块只下载一次
- 适用：大多数开发场景

#### 隔离模式
- 每个 Go 版本有独立的 GOPATH
- 模块缓存位置：`~/.govm/gopath/{version}/pkg/mod`
- 优点：完全隔离，避免版本兼容问题
- 适用：需要严格版本隔离的场景

### 切换版本时的处理

```
切换版本
    │
    ├─ 共享模式
    │   └─ GOPATH 保持不变
    │
    └─ 隔离模式
        └─ GOPATH 切换到对应版本目录
            └─ 更新环境变量 GOPATH
```

### 模块安全校验

使用 Go 官方的 checksum 数据库验证模块完整性：
- 校验和数据库：`sum.golang.org`
- 验证命令：`go mod verify`
- 显示校验结果：通过/失败/未知

---

## 优先级说明

- **P0**：核心功能，第一阶段必须实现
- **P1**：重要功能，第二阶段实现
- **P2**：增强功能，第三阶段实现

## 开发计划

### 第一阶段（P0 - 核心可用）

1. 项目初始化（Wails + Vue 3 + Element Plus）
2. 主界面框架搭建
3. 版本列表获取与展示
4. 版本安装（含进度条）
5. 版本切换
6. 版本卸载
7. 镜像源配置
8. 首次启动引导

### 第二阶段（P1 - 易用性）

1. 环境信息展示
2. 环境诊断功能
3. 项目级版本配置
4. 自动版本切换
5. 缓存清理
6. 主题/语言切换
7. 一键升级

### 第三阶段（P2 - 高级功能）

1. 工具链管理
2. 别名系统
3. 离线安装
4. 自动更新
5. 配置导入导出
6. 其他增强功能

---

## 下载源

### 官方源

```
https://go.dev/dl/
```

### 国内镜像

| 名称 | 地址 |
|------|------|
| 官方中国 | https://golang.google.cn/dl/ |
| 阿里云 | https://mirrors.aliyun.com/golang/ |
| 中科大 | https://mirrors.ustc.edu.cn/golang/ |

## 版本列表 API

```
https://go.dev/dl/?mode=json
https://go.dev/dl/?mode=json&include=all
```

返回格式：
```json
[
  {
    "version": "go1.21.5",
    "stable": true,
    "files": [
      {
        "filename": "go1.21.5.windows-amd64.zip",
        "os": "windows",
        "arch": "amd64",
        "sha256": "..."
      }
    ]
  }
]
```

---

## 开发环境搭建

### 前置要求

- Go 1.21+
- Node.js 18+
- pnpm（推荐）或 npm

### 安装 Wails

```bash
go install github.com/wailsapp/wails/v2/cmd/wails@latest
```

### 初始化项目

```bash
wails init -n govm -t vue-ts
```

### 开发模式

```bash
wails dev
```

### 构建发布

```bash
wails build
```
